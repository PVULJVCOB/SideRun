/* SideRun base styles used by js/siderun.js (desktop-focused) */
/*
  Stacking rules
  - .sr-backdrop (the blurred background) should live at z-index: 1
  - the SVG strokes (.siderun-border) and page content should live at z-index: 2
  This ensures blur sits underneath the frame and text while everything remains centered.
*/

/* Scoped variables for per-container tuning. These can be overridden on `.sr-container` if needed. */
.sr-container {
  /* Global scale factor for the entire SideRun visual. Change this on the host to scale
     stroke widths, blur radius, inset and corner radius together so the effect stays
     visually consistent across sizes. Default: 1 */
  --sr-scale: 1;
  /* Stroke and border tokens */
  --sr-stroke-width: calc(var(--sr-scale) * 3px); /* default stroke width (px) */
  --sr-stroke-width-outer: var(--sr-stroke-width);
  --sr-stroke-width-inner: var(--sr-stroke-width);
  --sr-stroke-width-runner: var(--sr-stroke-width);
  --sr-stroke-width-ghost: var(--sr-stroke-width);
  --sr-stroke-linecap: round; /* round | square | butt */

  /* Colors (inherit accent from global theme when available) */
  --sr-color-outer: var(--color-accent, #df6502);
  --sr-color-inner: #ffffff;
  --sr-color-runner: var(--color-accent, #df6502);
  --sr-color-ghost: #ffffff;
  --sr-opacity-outer: 1;
  --sr-opacity-inner: 1;
  --sr-opacity-runner: 1;
  --sr-opacity-ghost: 1;

  --sr-blur: calc(var(--sr-scale) * 10px); /* blur amount for backdrop */
  --sr-saturation: 140%;
  --sr-tint: rgba(255, 255, 255, 0.12);
  --sr-inset: calc(var(--sr-scale) * 1px);
  --sr-radius: calc(var(--sr-scale) * 6px);
}

.siderun-border {
  position: absolute; /* overlay the wrapper */
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 2; /* frame above the blur */
  pointer-events: none;
}
.siderun-border rect {
  vector-effect: non-scaling-stroke;
}
.siderun-border .sr-static-outer {
  stroke: var(--sr-color-outer, var(--color-accent, #df6502));
  stroke-opacity: var(--sr-opacity-outer, 1);
  stroke-width: var(--sr-stroke-width-outer, var(--sr-stroke-width, 3px));
  stroke-linecap: var(--sr-stroke-linecap, round);
  fill: none;
}
.siderun-border .sr-static-inner {
  stroke: var(--sr-color-inner, #ffffff);
  stroke-opacity: var(--sr-opacity-inner, 1);
  stroke-width: var(--sr-stroke-width-inner, var(--sr-stroke-width, 3px));
  stroke-linecap: var(--sr-stroke-linecap, round);
  fill: none;
}
.siderun-border .sr-runner {
  stroke: var(--sr-color-runner, var(--color-accent, #df6502));
  stroke-opacity: var(--sr-opacity-runner, 1);
  stroke-width: var(--sr-stroke-width-runner, var(--sr-stroke-width, 3px));
  stroke-linecap: var(--sr-stroke-linecap, round);
  fill: none;
}
.siderun-border .sr-runner-ghost {
  stroke: var(--sr-color-ghost, #ffffff);
  stroke-opacity: var(--sr-opacity-ghost, 1);
  stroke-width: var(--sr-stroke-width-ghost, var(--sr-stroke-width, 3px));
  stroke-linecap: var(--sr-stroke-linecap, round);
  fill: none;
}

/* Inner blur layer: clipped to the same rounded-rect area as the border */
.sr-backdrop {
  position: absolute;
  left: var(--sr-inset, 3px);
  top: var(--sr-inset, 3px);
  width: calc(100% - (var(--sr-inset, 3px) * 2));
  height: calc(100% - (var(--sr-inset, 3px) * 2));
  border-radius: var(--sr-radius, 6px);
  /* Keep interactions unaffected */
  pointer-events: none;
  /* Slight tint helps the blur read consistently across browsers */
  background: var(--sr-tint, rgba(255, 255, 255, 0.12));
  -webkit-backdrop-filter: blur(var(--sr-blur, 10px)) saturate(var(--sr-saturation, 140%));
  backdrop-filter: blur(var(--sr-blur, 10px)) saturate(var(--sr-saturation, 140%));
  z-index: 1; /* ensure backdrop sits below frame and content */
}

/* Ensure any svg injected into the stroke host scales to its container and cannot force overflow */
.site-nav__stroke.siderun svg,
.siderun-border {
  width: 100%;
  height: 100%;
  max-width: 100%;
  display: block;
  overflow: visible;
}

/* Responsive tuning: scale stroke/blur for smaller viewports so the effect scales as a group */
@media (max-width: 880px) {
  .sr-container {
    --sr-stroke-width: 3px;
    --sr-stroke-width-outer: var(--sr-stroke-width);
    --sr-stroke-width-inner: var(--sr-stroke-width);
    --sr-stroke-width-runner: var(--sr-stroke-width);
    --sr-stroke-width-ghost: var(--sr-stroke-width);
    --sr-blur: 8px;
    --sr-inset: 1px;
    --sr-radius: 6px;
  }
}

@media (max-width: 420px) {
  .sr-container {
    --sr-stroke-width: 3px;
    --sr-stroke-width-outer: var(--sr-stroke-width);
    --sr-stroke-width-inner: var(--sr-stroke-width);
    --sr-stroke-width-runner: var(--sr-stroke-width);
    --sr-stroke-width-ghost: var(--sr-stroke-width);
    --sr-blur: 5px;
    --sr-inset: 1px;
    --sr-radius: 5px;
  }
}

/* ========== MOBILE TOUCH OPTIMIZATIONS FOR SIDERUN ========== */
@media (max-width: 768px) {
  /* All SideRun elements optimized for touch */
  .siderun,
  .sr-container,
  .site-nav__stroke.siderun,
  #logo.nav_button-left.siderun,
  .site-nav.siderun,
  .mobile-nav.siderun {
    /* Prevent text selection during touch interactions */
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    
    /* Optimize touch events */
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    
    /* Prevent text cursor */
    cursor: default;
  }
  
  /* Demo containers specifically for touch */
  .demo-siderun,
  .demo-siderun-follow {
    /* Enable touch tracking for SideRun demos */
    touch-action: none; /* Allow SideRun to handle all pointer events */
    user-select: none;
    -webkit-user-select: none;
    
    /* Prevent context menus on long press */
    -webkit-touch-callout: none;
    -webkit-context-menu: none;
    
    /* Smooth touch interactions */
    -webkit-overflow-scrolling: touch;
  }
  
  /* Navigation elements should not interfere with scrolling */
  #logo.nav_button-left.siderun,
  .mobile-nav.siderun .site-nav__button.siderun,
  .menu-prompt.siderun {
    touch-action: manipulation; /* Allow default button behavior */
  }
  
  /* Links in mobile menu */
  .mobile-menu__link.siderun,
  .site-nav__link.siderun {
    touch-action: manipulation;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
    user-select: none;
  }
  
  /* Reduce blur on mobile for better performance */
  .sr-backdrop {
    -webkit-backdrop-filter: blur(calc(var(--sr-blur, 5px) * 0.7)) saturate(var(--sr-saturation, 120%));
    backdrop-filter: blur(calc(var(--sr-blur, 5px) * 0.7)) saturate(var(--sr-saturation, 120%));
  }
  
  /* Ensure SideRun containers have adequate touch targets */
  .sr-container {
    min-height: 44px; /* iOS recommended minimum touch target */
    padding: 8px;
  }
}
